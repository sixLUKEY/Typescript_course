(()=>{"use strict";function e(e,t,n){const r=n.value;return{configurable:!0,get(){return r.bind(this)}}}var t;!function(e){e[e.Active=0]="Active",e[e.Finished=1]="Finished"}(t||(t={}));class n{constructor(e,t,n,r,s){this.id=e,this.title=t,this.description=n,this.people=r,this.status=s}}class r{constructor(){this.listeners=[]}addListener(e){this.listeners.push(e)}}class s extends r{constructor(){super(),this.projects=[]}static getInstance(){return this.instance||(this.instance=new s),this.instance}addProject(e,r,s){const i=new n(Math.random().toString(),e,r,s,t.Active);this.projects.push(i),this.updateListeners()}moveProject(e,t){const n=this.projects.find((t=>t.id===e));n&&n.status!==t&&(n.status=t,this.updateListeners())}updateListeners(){for(const e of this.listeners)e(this.projects.slice())}}const i=s.getInstance();function l(e){let t=!0;return e.required&&(t=t&&0!==e.value.toString().trim().length),null!=e.minLength&&"string"==typeof e.value&&(t=t&&e.value.length>=e.minLength),null!=e.maxLength&&"string"==typeof e.value&&(t=t&&e.value.length<=e.maxLength),null!=e.min&&"number"==typeof e.value&&(t=t&&e.value>=e.min),null!=e.max&&"number"==typeof e.value&&(t=t&&e.value<=e.max),t}class o{constructor(e,t,n,r){this.templateElement=document.getElementById(e),this.hostElement=document.getElementById(t);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,r&&(this.element.id=r),this.attach(n)}attach(e){this.hostElement.insertAdjacentElement(e?"afterbegin":"beforeend",this.element)}}class a extends o{constructor(){super("project-input","app",!0,"user-input"),this.titleInputElement=this.element.querySelector("#title"),this.descriptionInputElement=this.element.querySelector("#description"),this.peopleInputElement=this.element.querySelector("#people"),this.configure()}renderContent(){}configure(){this.element.addEventListener("submit",this.submitHandler)}gatherUserInput(){const e=this.titleInputElement.value,t=this.descriptionInputElement.value,n=this.peopleInputElement.value,r={value:t,required:!0,minLength:5},s={value:+n,required:!0,min:1,max:5};if(l({value:e,required:!0})&&l(r)&&l(s))return[e,t,+n];alert("Invalid input!")}submitHandler(e){e.preventDefault();const t=this.gatherUserInput();if(Array.isArray(t)){const[e,n,r]=t;i.addProject(e,n,r),this.clearInputs()}}clearInputs(){this.titleInputElement.value="",this.descriptionInputElement.value="",this.peopleInputElement.value=""}}!function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);i>3&&l&&Object.defineProperty(t,n,l)}([e],a.prototype,"submitHandler",null);var c=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class d extends o{get persons(){return 1===this.project.people?"1 person":`${this.project.people} persons`}constructor(e,t){super("single-project",e,!1,t.id),this.project=t,this.configure(),this.renderContent()}dragStartHandler(e){e.dataTransfer.setData("text/plain",this.project.id),e.dataTransfer.effectAllowed="move"}dragEndHandler(e){console.log("DragEnd")}configure(){this.element.addEventListener("dragstart",this.dragStartHandler),this.element.addEventListener("dragend",this.dragEndHandler)}renderContent(){this.element.querySelector("h2").textContent=this.project.title,this.element.querySelector("h3").textContent=this.persons+" assigned",this.element.querySelector("p").textContent=this.project.description}}c([e],d.prototype,"dragStartHandler",null),c([e],d.prototype,"dragEndHandler",null);var p=function(e,t,n,r){var s,i=arguments.length,l=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)l=Reflect.decorate(e,t,n,r);else for(var o=e.length-1;o>=0;o--)(s=e[o])&&(l=(i<3?s(l):i>3?s(t,n,l):s(t,n))||l);return i>3&&l&&Object.defineProperty(t,n,l),l};class u extends o{constructor(e){super("project-list","app",!1,`${e}-projects`),this.type=e,this.assignedProjects=[],this.configure(),this.renderContent()}dragOverHandler(e){e.dataTransfer&&"text/plain"===e.dataTransfer.types[0]&&(e.preventDefault(),this.element.querySelector("ul").classList.add("droppable"))}dropHandler(e){const n=e.dataTransfer.getData("text/plain");i.moveProject(n,"active"===this.type?t.Active:t.Finished)}dragLeaveHandler(e){this.element.querySelector("ul").classList.remove("droppable")}configure(){this.element.addEventListener("dragover",this.dragOverHandler),this.element.addEventListener("dragleave",this.dragLeaveHandler),this.element.addEventListener("drop",this.dropHandler),i.addListener((e=>{const n=e.filter((e=>"active"===this.type?e.status===t.Active:e.status===t.Finished));this.assignedProjects=n,this.renderProjects()}))}renderContent(){const e=`${this.type}-projects-list`;this.element.querySelector("ul").id=e,this.element.querySelector("h2").textContent=this.type.toUpperCase()+" PROJECTS"}renderProjects(){document.getElementById(`${this.type}-projects-list`).innerHTML="";for(const e of this.assignedProjects)new d(this.element.querySelector("ul").id,e)}}p([e],u.prototype,"dragOverHandler",null),p([e],u.prototype,"dropHandler",null),p([e],u.prototype,"dragLeaveHandler",null),new a,new u("active"),new u("finished")})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFLaUgsaUJBQy9DakgsS0FBS3dELFFBQVFZLGlCQUFpQixZQUFhcEUsS0FBS3lILGtCQUNoRHpILEtBQUt3RCxRQUFRWSxpQkFBaUIsT0FBUXBFLEtBQUtxSCxhQUMzQ3BGLEVBQWF0QixhQUFhSyxJQUN0QixNQUFNMkcsRUFBbUIzRyxFQUFTNEcsUUFBUTdGLEdBQ3BCLFdBQWQvQixLQUFLK0csS0FDRWhGLEVBQUl2QixTQUFXUCxFQUFjdUIsT0FFakNPLEVBQUl2QixTQUFXUCxFQUFjdUgsV0FFeEN4SCxLQUFLZ0gsaUJBQW1CVyxFQUN4QjNILEtBQUs2SCxnQkFBZ0IsR0FFN0IsQ0FDQSxhQUFBMUQsR0FDSSxNQUFNMkQsRUFBUyxHQUFHOUgsS0FBSytHLHFCQUN2Qi9HLEtBQUt3RCxRQUFRTyxjQUFjLE1BQU0zRCxHQUFLMEgsRUFDdEM5SCxLQUFLd0QsUUFBUU8sY0FBYyxNQUFNOEMsWUFDN0I3RyxLQUFLK0csS0FBS2dCLGNBQWdCLFdBQ2xDLENBQ0EsY0FBQUYsR0FDbUIzRSxTQUFTQyxlQUFlLEdBQUduRCxLQUFLK0csc0JBQ3hDaUIsVUFBWSxHQUNuQixJQUFLLE1BQU1DLEtBQVdqSSxLQUFLZ0gsaUJBQ3ZCLElBQUliLEVBQVluRyxLQUFLd0QsUUFBUU8sY0FBYyxNQUFNM0QsR0FBSTZILEVBRTdELEVBRUosRUFBVyxDQUNQMUksR0FDRHVILEVBQVlaLFVBQVcsa0JBQW1CLE1BQzdDLEVBQVcsQ0FDUDNHLEdBQ0R1SCxFQUFZWixVQUFXLGNBQWUsTUFDekMsRUFBVyxDQUNQM0csR0FDRHVILEVBQVlaLFVBQVcsbUJBQW9CLE1DdEU5QyxJQUFJckMsRUFDSixJQUFJaUQsRUFBWSxVQUNoQixJQUFJQSxFQUFZLFciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly90cy1hcHAvLi9zcmMvZGVjb3JhdG9ycy9hdXRvYmluZC50cyIsIndlYnBhY2s6Ly90cy1hcHAvLi9zcmMvbW9kZWxzL3Byb2plY3QudHMiLCJ3ZWJwYWNrOi8vdHMtYXBwLy4vc3JjL3N0YXRlL3Byb2plY3Qtc3RhdGUudHMiLCJ3ZWJwYWNrOi8vdHMtYXBwLy4vc3JjL3V0aWwvdmFsaWRhdGlvbi50cyIsIndlYnBhY2s6Ly90cy1hcHAvLi9zcmMvY29tcG9uZW50cy9iYXNlLWNvbXBvbmVudC50cyIsIndlYnBhY2s6Ly90cy1hcHAvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWlucHV0LnRzIiwid2VicGFjazovL3RzLWFwcC8uL3NyYy9jb21wb25lbnRzL3Byb2plY3QtaXRlbS50cyIsIndlYnBhY2s6Ly90cy1hcHAvLi9zcmMvY29tcG9uZW50cy9wcm9qZWN0LWxpc3QudHMiLCJ3ZWJwYWNrOi8vdHMtYXBwLy4vc3JjL2FwcC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBBdXRvYmluZCBkZWNvcmF0b3JcbmV4cG9ydCBmdW5jdGlvbiBhdXRvQmluZChfLCBfMiwgZGVzY3JpcHRvcikge1xuICAgIGNvbnN0IG9yaWdpbmFsTWV0aG9kID0gZGVzY3JpcHRvci52YWx1ZTtcbiAgICBjb25zdCBhZGpEZXNjcmlwdG9yID0ge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGdldCgpIHtcbiAgICAgICAgICAgIGNvbnN0IGJvdW5kRm4gPSBvcmlnaW5hbE1ldGhvZC5iaW5kKHRoaXMpO1xuICAgICAgICAgICAgcmV0dXJuIGJvdW5kRm47XG4gICAgICAgIH0sXG4gICAgfTtcbiAgICByZXR1cm4gYWRqRGVzY3JpcHRvcjtcbn1cbiIsImV4cG9ydCB2YXIgUHJvamVjdFN0YXR1cztcbihmdW5jdGlvbiAoUHJvamVjdFN0YXR1cykge1xuICAgIFByb2plY3RTdGF0dXNbUHJvamVjdFN0YXR1c1tcIkFjdGl2ZVwiXSA9IDBdID0gXCJBY3RpdmVcIjtcbiAgICBQcm9qZWN0U3RhdHVzW1Byb2plY3RTdGF0dXNbXCJGaW5pc2hlZFwiXSA9IDFdID0gXCJGaW5pc2hlZFwiO1xufSkoUHJvamVjdFN0YXR1cyB8fCAoUHJvamVjdFN0YXR1cyA9IHt9KSk7XG4vLyBQcm9qZWN0IFR5cGVcbmV4cG9ydCBjbGFzcyBQcm9qZWN0IHtcbiAgICBjb25zdHJ1Y3RvcihpZCwgdGl0bGUsIGRlc2NyaXB0aW9uLCBwZW9wbGUsIHN0YXR1cykge1xuICAgICAgICB0aGlzLmlkID0gaWQ7XG4gICAgICAgIHRoaXMudGl0bGUgPSB0aXRsZTtcbiAgICAgICAgdGhpcy5kZXNjcmlwdGlvbiA9IGRlc2NyaXB0aW9uO1xuICAgICAgICB0aGlzLnBlb3BsZSA9IHBlb3BsZTtcbiAgICAgICAgdGhpcy5zdGF0dXMgPSBzdGF0dXM7XG4gICAgfVxufVxuIiwiaW1wb3J0IHsgUHJvamVjdCwgUHJvamVjdFN0YXR1cyB9IGZyb20gXCIuLi9tb2RlbHMvcHJvamVjdFwiO1xuLy8gU3RhdGUgQ2xhc3NcbmNsYXNzIFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgdGhpcy5saXN0ZW5lcnMgPSBbXTtcbiAgICB9XG4gICAgYWRkTGlzdGVuZXIobGlzdGVuZXJGbikge1xuICAgICAgICB0aGlzLmxpc3RlbmVycy5wdXNoKGxpc3RlbmVyRm4pO1xuICAgIH1cbn1cbi8vIFByb2plY3QgU3RhdGUgTWFuYWdlbWVudFxuZXhwb3J0IGNsYXNzIFByb2plY3RTdGF0ZSBleHRlbmRzIFN0YXRlIHtcbiAgICBjb25zdHJ1Y3RvcigpIHtcbiAgICAgICAgc3VwZXIoKTtcbiAgICAgICAgdGhpcy5wcm9qZWN0cyA9IFtdO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0SW5zdGFuY2UoKSB7XG4gICAgICAgIGlmICh0aGlzLmluc3RhbmNlKSB7XG4gICAgICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmluc3RhbmNlID0gbmV3IFByb2plY3RTdGF0ZSgpO1xuICAgICAgICByZXR1cm4gdGhpcy5pbnN0YW5jZTtcbiAgICB9XG4gICAgYWRkUHJvamVjdCh0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZSkge1xuICAgICAgICBjb25zdCBuZXdQcm9qZWN0ID0gbmV3IFByb2plY3QoTWF0aC5yYW5kb20oKS50b1N0cmluZygpLCB0aXRsZSwgZGVzY3JpcHRpb24sIHBlb3BsZSwgUHJvamVjdFN0YXR1cy5BY3RpdmUpO1xuICAgICAgICB0aGlzLnByb2plY3RzLnB1c2gobmV3UHJvamVjdCk7XG4gICAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gICAgfVxuICAgIG1vdmVQcm9qZWN0KHByb2plY3RJZCwgbmV3U3RhdHVzKSB7XG4gICAgICAgIGNvbnN0IHByb2plY3QgPSB0aGlzLnByb2plY3RzLmZpbmQoKHByaikgPT4gcHJqLmlkID09PSBwcm9qZWN0SWQpO1xuICAgICAgICBpZiAocHJvamVjdCAmJiBwcm9qZWN0LnN0YXR1cyAhPT0gbmV3U3RhdHVzKSB7XG4gICAgICAgICAgICBwcm9qZWN0LnN0YXR1cyA9IG5ld1N0YXR1cztcbiAgICAgICAgICAgIHRoaXMudXBkYXRlTGlzdGVuZXJzKCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgdXBkYXRlTGlzdGVuZXJzKCkge1xuICAgICAgICBmb3IgKGNvbnN0IGxpc3RlbmVyRm4gb2YgdGhpcy5saXN0ZW5lcnMpIHtcbiAgICAgICAgICAgIGxpc3RlbmVyRm4odGhpcy5wcm9qZWN0cy5zbGljZSgpKTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmV4cG9ydCBjb25zdCBwcm9qZWN0U3RhdGUgPSBQcm9qZWN0U3RhdGUuZ2V0SW5zdGFuY2UoKTtcbiIsImV4cG9ydCBmdW5jdGlvbiB2YWxpZGF0ZSh2YWxpZGF0YWJsZUlucHV0KSB7XG4gICAgbGV0IGlzVmFsaWQgPSB0cnVlO1xuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0LnJlcXVpcmVkKSB7XG4gICAgICAgIGlzVmFsaWQgPSBpc1ZhbGlkICYmIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUudG9TdHJpbmcoKS50cmltKCkubGVuZ3RoICE9PSAwO1xuICAgIH1cbiAgICBpZiAodmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGggIT0gbnVsbCAmJlxuICAgICAgICB0eXBlb2YgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBpc1ZhbGlkID1cbiAgICAgICAgICAgIGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZS5sZW5ndGggPj0gdmFsaWRhdGFibGVJbnB1dC5taW5MZW5ndGg7XG4gICAgfVxuICAgIGlmICh2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aCAhPSBudWxsICYmXG4gICAgICAgIHR5cGVvZiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIGlzVmFsaWQgPVxuICAgICAgICAgICAgaXNWYWxpZCAmJiB2YWxpZGF0YWJsZUlucHV0LnZhbHVlLmxlbmd0aCA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heExlbmd0aDtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWluICE9IG51bGwgJiZcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA+PSB2YWxpZGF0YWJsZUlucHV0Lm1pbjtcbiAgICB9XG4gICAgaWYgKHZhbGlkYXRhYmxlSW5wdXQubWF4ICE9IG51bGwgJiZcbiAgICAgICAgdHlwZW9mIHZhbGlkYXRhYmxlSW5wdXQudmFsdWUgPT09IFwibnVtYmVyXCIpIHtcbiAgICAgICAgaXNWYWxpZCA9IGlzVmFsaWQgJiYgdmFsaWRhdGFibGVJbnB1dC52YWx1ZSA8PSB2YWxpZGF0YWJsZUlucHV0Lm1heDtcbiAgICB9XG4gICAgcmV0dXJuIGlzVmFsaWQ7XG59XG4iLCIvLyBDb21wb25lbnQgQmFzZSBDbGFzc1xuZXhwb3J0IGRlZmF1bHQgY2xhc3MgQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcih0ZW1wbGF0ZUlkLCBob3N0RWxlbWVudElkLCBpbnNlcnRBdFN0YXJ0LCBuZXdFbGVtZW50SWQpIHtcbiAgICAgICAgKHRoaXMudGVtcGxhdGVFbGVtZW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQodGVtcGxhdGVJZCkpLFxuICAgICAgICAgICAgKHRoaXMuaG9zdEVsZW1lbnQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChob3N0RWxlbWVudElkKSk7XG4gICAgICAgIGNvbnN0IGltcG9ydGVkTm9kZSA9IGRvY3VtZW50LmltcG9ydE5vZGUodGhpcy50ZW1wbGF0ZUVsZW1lbnQuY29udGVudCwgdHJ1ZSk7XG4gICAgICAgIHRoaXMuZWxlbWVudCA9IGltcG9ydGVkTm9kZS5maXJzdEVsZW1lbnRDaGlsZDtcbiAgICAgICAgaWYgKG5ld0VsZW1lbnRJZCkge1xuICAgICAgICAgICAgdGhpcy5lbGVtZW50LmlkID0gbmV3RWxlbWVudElkO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuYXR0YWNoKGluc2VydEF0U3RhcnQpO1xuICAgIH1cbiAgICBhdHRhY2goaW5zZXJ0QXRCZWdpbm5pbmcpIHtcbiAgICAgICAgdGhpcy5ob3N0RWxlbWVudC5pbnNlcnRBZGphY2VudEVsZW1lbnQoaW5zZXJ0QXRCZWdpbm5pbmcgPyBcImFmdGVyYmVnaW5cIiA6IFwiYmVmb3JlZW5kXCIsIHRoaXMuZWxlbWVudCk7XG4gICAgfVxufVxuIiwidmFyIF9fZGVjb3JhdGUgPSAodGhpcyAmJiB0aGlzLl9fZGVjb3JhdGUpIHx8IGZ1bmN0aW9uIChkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYykge1xuICAgIHZhciBjID0gYXJndW1lbnRzLmxlbmd0aCwgciA9IGMgPCAzID8gdGFyZ2V0IDogZGVzYyA9PT0gbnVsbCA/IGRlc2MgPSBPYmplY3QuZ2V0T3duUHJvcGVydHlEZXNjcmlwdG9yKHRhcmdldCwga2V5KSA6IGRlc2MsIGQ7XG4gICAgaWYgKHR5cGVvZiBSZWZsZWN0ID09PSBcIm9iamVjdFwiICYmIHR5cGVvZiBSZWZsZWN0LmRlY29yYXRlID09PSBcImZ1bmN0aW9uXCIpIHIgPSBSZWZsZWN0LmRlY29yYXRlKGRlY29yYXRvcnMsIHRhcmdldCwga2V5LCBkZXNjKTtcbiAgICBlbHNlIGZvciAodmFyIGkgPSBkZWNvcmF0b3JzLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSBpZiAoZCA9IGRlY29yYXRvcnNbaV0pIHIgPSAoYyA8IDMgPyBkKHIpIDogYyA+IDMgPyBkKHRhcmdldCwga2V5LCByKSA6IGQodGFyZ2V0LCBrZXkpKSB8fCByO1xuICAgIHJldHVybiBjID4gMyAmJiByICYmIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0YXJnZXQsIGtleSwgciksIHI7XG59O1xuaW1wb3J0IHsgYXV0b0JpbmQgYXMgQXV0b0JpbmQgfSBmcm9tIFwiLi4vZGVjb3JhdG9ycy9hdXRvYmluZFwiO1xuaW1wb3J0IHsgcHJvamVjdFN0YXRlIH0gZnJvbSBcIi4uL3N0YXRlL3Byb2plY3Qtc3RhdGVcIjtcbmltcG9ydCAqIGFzIFZhbGlkYXRpb24gZnJvbSBcIi4uL3V0aWwvdmFsaWRhdGlvblwiO1xuaW1wb3J0IEJhc2VDb21wb25lbnQgZnJvbSBcIi4vYmFzZS1jb21wb25lbnRcIjtcbi8vIFByb2plY3RJbnB1dCBjbGFzc1xuZXhwb3J0IGNsYXNzIFByb2plY3RJbnB1dCBleHRlbmRzIEJhc2VDb21wb25lbnQge1xuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgICBzdXBlcihcInByb2plY3QtaW5wdXRcIiwgXCJhcHBcIiwgdHJ1ZSwgXCJ1c2VyLWlucHV0XCIpO1xuICAgICAgICB0aGlzLnRpdGxlSW5wdXRFbGVtZW50ID0gdGhpcy5lbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjdGl0bGVcIik7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNkZXNjcmlwdGlvblwiKTtcbiAgICAgICAgdGhpcy5wZW9wbGVJbnB1dEVsZW1lbnQgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcIiNwZW9wbGVcIik7XG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgfVxuICAgIHJlbmRlckNvbnRlbnQoKSB7IH1cbiAgICBjb25maWd1cmUoKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIHRoaXMuc3VibWl0SGFuZGxlcik7XG4gICAgfVxuICAgIGdhdGhlclVzZXJJbnB1dCgpIHtcbiAgICAgICAgY29uc3QgZW50ZXJlZFRpdGxlID0gdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZERlc2NyaXB0aW9uID0gdGhpcy5kZXNjcmlwdGlvbklucHV0RWxlbWVudC52YWx1ZTtcbiAgICAgICAgY29uc3QgZW50ZXJlZFBlb3BsZSA9IHRoaXMucGVvcGxlSW5wdXRFbGVtZW50LnZhbHVlO1xuICAgICAgICBjb25zdCB0aXRsZVZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWRUaXRsZSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBkZXNjcmlwdGlvblZhbGlkYXRhYmxlID0ge1xuICAgICAgICAgICAgdmFsdWU6IGVudGVyZWREZXNjcmlwdGlvbixcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgbWluTGVuZ3RoOiA1LFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBwZW9wbGVWYWxpZGF0YWJsZSA9IHtcbiAgICAgICAgICAgIHZhbHVlOiArZW50ZXJlZFBlb3BsZSxcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgbWluOiAxLFxuICAgICAgICAgICAgbWF4OiA1LFxuICAgICAgICB9O1xuICAgICAgICBpZiAoIVZhbGlkYXRpb24udmFsaWRhdGUodGl0bGVWYWxpZGF0YWJsZSkgfHxcbiAgICAgICAgICAgICFWYWxpZGF0aW9uLnZhbGlkYXRlKGRlc2NyaXB0aW9uVmFsaWRhdGFibGUpIHx8XG4gICAgICAgICAgICAhVmFsaWRhdGlvbi52YWxpZGF0ZShwZW9wbGVWYWxpZGF0YWJsZSkpIHtcbiAgICAgICAgICAgIGFsZXJ0KFwiSW52YWxpZCBpbnB1dCFcIik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXR1cm4gW2VudGVyZWRUaXRsZSwgZW50ZXJlZERlc2NyaXB0aW9uLCArZW50ZXJlZFBlb3BsZV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgc3VibWl0SGFuZGxlcihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBjb25zdCB1c2VySW5wdXQgPSB0aGlzLmdhdGhlclVzZXJJbnB1dCgpO1xuICAgICAgICBpZiAoQXJyYXkuaXNBcnJheSh1c2VySW5wdXQpKSB7XG4gICAgICAgICAgICBjb25zdCBbdGl0bGUsIGRlc2MsIHBlb3BsZV0gPSB1c2VySW5wdXQ7XG4gICAgICAgICAgICBwcm9qZWN0U3RhdGUuYWRkUHJvamVjdCh0aXRsZSwgZGVzYywgcGVvcGxlKTtcbiAgICAgICAgICAgIHRoaXMuY2xlYXJJbnB1dHMoKTtcbiAgICAgICAgfVxuICAgIH1cbiAgICBjbGVhcklucHV0cygpIHtcbiAgICAgICAgdGhpcy50aXRsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgICAgIHRoaXMuZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQudmFsdWUgPSBcIlwiO1xuICAgICAgICB0aGlzLnBlb3BsZUlucHV0RWxlbWVudC52YWx1ZSA9IFwiXCI7XG4gICAgfVxufVxuX19kZWNvcmF0ZShbXG4gICAgQXV0b0JpbmRcbl0sIFByb2plY3RJbnB1dC5wcm90b3R5cGUsIFwic3VibWl0SGFuZGxlclwiLCBudWxsKTtcbiIsInZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xufTtcbmltcG9ydCB7IGF1dG9CaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCBCYXNlQ29tcG9uZW50IGZyb20gXCIuL2Jhc2UtY29tcG9uZW50XCI7XG4vLyBQcm9qZWN0SXRlbSBDbGFzc1xuZXhwb3J0IGNsYXNzIFByb2plY3RJdGVtIGV4dGVuZHMgQmFzZUNvbXBvbmVudCB7XG4gICAgZ2V0IHBlcnNvbnMoKSB7XG4gICAgICAgIGlmICh0aGlzLnByb2plY3QucGVvcGxlID09PSAxKSB7XG4gICAgICAgICAgICByZXR1cm4gXCIxIHBlcnNvblwiO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBgJHt0aGlzLnByb2plY3QucGVvcGxlfSBwZXJzb25zYDtcbiAgICB9XG4gICAgY29uc3RydWN0b3IoaG9zdElkLCBwcm9qZWN0KSB7XG4gICAgICAgIHN1cGVyKFwic2luZ2xlLXByb2plY3RcIiwgaG9zdElkLCBmYWxzZSwgcHJvamVjdC5pZCk7XG4gICAgICAgIHRoaXMucHJvamVjdCA9IHByb2plY3Q7XG4gICAgICAgIHRoaXMuY29uZmlndXJlKCk7XG4gICAgICAgIHRoaXMucmVuZGVyQ29udGVudCgpO1xuICAgIH1cbiAgICBkcmFnU3RhcnRIYW5kbGVyKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LmRhdGFUcmFuc2Zlci5zZXREYXRhKFwidGV4dC9wbGFpblwiLCB0aGlzLnByb2plY3QuaWQpO1xuICAgICAgICBldmVudC5kYXRhVHJhbnNmZXIuZWZmZWN0QWxsb3dlZCA9IFwibW92ZVwiO1xuICAgIH1cbiAgICBkcmFnRW5kSGFuZGxlcihfKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwiRHJhZ0VuZFwiKTtcbiAgICB9XG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdzdGFydFwiLCB0aGlzLmRyYWdTdGFydEhhbmRsZXIpO1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdlbmRcIiwgdGhpcy5kcmFnRW5kSGFuZGxlcik7XG4gICAgfVxuICAgIHJlbmRlckNvbnRlbnQoKSB7XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDJcIikudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QudGl0bGU7XG4gICAgICAgIHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiaDNcIikudGV4dENvbnRlbnQgPSB0aGlzLnBlcnNvbnMgKyBcIiBhc3NpZ25lZFwiO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInBcIikudGV4dENvbnRlbnQgPSB0aGlzLnByb2plY3QuZGVzY3JpcHRpb247XG4gICAgfVxufVxuX19kZWNvcmF0ZShbXG4gICAgYXV0b0JpbmRcbl0sIFByb2plY3RJdGVtLnByb3RvdHlwZSwgXCJkcmFnU3RhcnRIYW5kbGVyXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgYXV0b0JpbmRcbl0sIFByb2plY3RJdGVtLnByb3RvdHlwZSwgXCJkcmFnRW5kSGFuZGxlclwiLCBudWxsKTtcbiIsInZhciBfX2RlY29yYXRlID0gKHRoaXMgJiYgdGhpcy5fX2RlY29yYXRlKSB8fCBmdW5jdGlvbiAoZGVjb3JhdG9ycywgdGFyZ2V0LCBrZXksIGRlc2MpIHtcbiAgICB2YXIgYyA9IGFyZ3VtZW50cy5sZW5ndGgsIHIgPSBjIDwgMyA/IHRhcmdldCA6IGRlc2MgPT09IG51bGwgPyBkZXNjID0gT2JqZWN0LmdldE93blByb3BlcnR5RGVzY3JpcHRvcih0YXJnZXQsIGtleSkgOiBkZXNjLCBkO1xuICAgIGlmICh0eXBlb2YgUmVmbGVjdCA9PT0gXCJvYmplY3RcIiAmJiB0eXBlb2YgUmVmbGVjdC5kZWNvcmF0ZSA9PT0gXCJmdW5jdGlvblwiKSByID0gUmVmbGVjdC5kZWNvcmF0ZShkZWNvcmF0b3JzLCB0YXJnZXQsIGtleSwgZGVzYyk7XG4gICAgZWxzZSBmb3IgKHZhciBpID0gZGVjb3JhdG9ycy5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgaWYgKGQgPSBkZWNvcmF0b3JzW2ldKSByID0gKGMgPCAzID8gZChyKSA6IGMgPiAzID8gZCh0YXJnZXQsIGtleSwgcikgOiBkKHRhcmdldCwga2V5KSkgfHwgcjtcbiAgICByZXR1cm4gYyA+IDMgJiYgciAmJiBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBrZXksIHIpLCByO1xufTtcbmltcG9ydCB7IGF1dG9CaW5kIH0gZnJvbSBcIi4uL2RlY29yYXRvcnMvYXV0b2JpbmRcIjtcbmltcG9ydCB7IFByb2plY3RTdGF0dXMgfSBmcm9tIFwiLi4vbW9kZWxzL3Byb2plY3RcIjtcbmltcG9ydCB7IHByb2plY3RTdGF0ZSB9IGZyb20gXCIuLi9zdGF0ZS9wcm9qZWN0LXN0YXRlXCI7XG5pbXBvcnQgQmFzZUNvbXBvbmVudCBmcm9tIFwiLi9iYXNlLWNvbXBvbmVudFwiO1xuaW1wb3J0IHsgUHJvamVjdEl0ZW0gfSBmcm9tIFwiLi9wcm9qZWN0LWl0ZW1cIjtcbi8vIFByb2plY3RMaXN0IENsYXNzXG5leHBvcnQgY2xhc3MgUHJvamVjdExpc3QgZXh0ZW5kcyBCYXNlQ29tcG9uZW50IHtcbiAgICBjb25zdHJ1Y3Rvcih0eXBlKSB7XG4gICAgICAgIHN1cGVyKFwicHJvamVjdC1saXN0XCIsIFwiYXBwXCIsIGZhbHNlLCBgJHt0eXBlfS1wcm9qZWN0c2ApO1xuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xuICAgICAgICB0aGlzLmFzc2lnbmVkUHJvamVjdHMgPSBbXTtcbiAgICAgICAgdGhpcy5jb25maWd1cmUoKTtcbiAgICAgICAgdGhpcy5yZW5kZXJDb250ZW50KCk7XG4gICAgfVxuICAgIGRyYWdPdmVySGFuZGxlcihldmVudCkge1xuICAgICAgICBpZiAoZXZlbnQuZGF0YVRyYW5zZmVyICYmIGV2ZW50LmRhdGFUcmFuc2Zlci50eXBlc1swXSA9PT0gXCJ0ZXh0L3BsYWluXCIpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpO1xuICAgICAgICAgICAgbGlzdEVsLmNsYXNzTGlzdC5hZGQoXCJkcm9wcGFibGVcIik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZHJvcEhhbmRsZXIoZXZlbnQpIHtcbiAgICAgICAgY29uc3QgcHJqSWQgPSBldmVudC5kYXRhVHJhbnNmZXIuZ2V0RGF0YShcInRleHQvcGxhaW5cIik7XG4gICAgICAgIHByb2plY3RTdGF0ZS5tb3ZlUHJvamVjdChwcmpJZCwgdGhpcy50eXBlID09PSBcImFjdGl2ZVwiID8gUHJvamVjdFN0YXR1cy5BY3RpdmUgOiBQcm9qZWN0U3RhdHVzLkZpbmlzaGVkKTtcbiAgICB9XG4gICAgZHJhZ0xlYXZlSGFuZGxlcihldmVudCkge1xuICAgICAgICBjb25zdCBsaXN0RWwgPSB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpO1xuICAgICAgICBsaXN0RWwuY2xhc3NMaXN0LnJlbW92ZShcImRyb3BwYWJsZVwiKTtcbiAgICB9XG4gICAgY29uZmlndXJlKCkge1xuICAgICAgICB0aGlzLmVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImRyYWdvdmVyXCIsIHRoaXMuZHJhZ092ZXJIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcmFnbGVhdmVcIiwgdGhpcy5kcmFnTGVhdmVIYW5kbGVyKTtcbiAgICAgICAgdGhpcy5lbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJkcm9wXCIsIHRoaXMuZHJvcEhhbmRsZXIpO1xuICAgICAgICBwcm9qZWN0U3RhdGUuYWRkTGlzdGVuZXIoKHByb2plY3RzKSA9PiB7XG4gICAgICAgICAgICBjb25zdCByZWxldmFudFByb2plY3RzID0gcHJvamVjdHMuZmlsdGVyKChwcmopID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy50eXBlID09PSBcImFjdGl2ZVwiKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBwcmouc3RhdHVzID09PSBQcm9qZWN0U3RhdHVzLkFjdGl2ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuIHByai5zdGF0dXMgPT09IFByb2plY3RTdGF0dXMuRmluaXNoZWQ7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuYXNzaWduZWRQcm9qZWN0cyA9IHJlbGV2YW50UHJvamVjdHM7XG4gICAgICAgICAgICB0aGlzLnJlbmRlclByb2plY3RzKCk7XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICByZW5kZXJDb250ZW50KCkge1xuICAgICAgICBjb25zdCBsaXN0SWQgPSBgJHt0aGlzLnR5cGV9LXByb2plY3RzLWxpc3RgO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcInVsXCIpLmlkID0gbGlzdElkO1xuICAgICAgICB0aGlzLmVsZW1lbnQucXVlcnlTZWxlY3RvcihcImgyXCIpLnRleHRDb250ZW50ID1cbiAgICAgICAgICAgIHRoaXMudHlwZS50b1VwcGVyQ2FzZSgpICsgXCIgUFJPSkVDVFNcIjtcbiAgICB9XG4gICAgcmVuZGVyUHJvamVjdHMoKSB7XG4gICAgICAgIGNvbnN0IGxpc3RFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGAke3RoaXMudHlwZX0tcHJvamVjdHMtbGlzdGApO1xuICAgICAgICBsaXN0RWwuaW5uZXJIVE1MID0gXCJcIjtcbiAgICAgICAgZm9yIChjb25zdCBwcmpJdGVtIG9mIHRoaXMuYXNzaWduZWRQcm9qZWN0cykge1xuICAgICAgICAgICAgbmV3IFByb2plY3RJdGVtKHRoaXMuZWxlbWVudC5xdWVyeVNlbGVjdG9yKFwidWxcIikuaWQsIHByakl0ZW0pO1xuICAgICAgICB9XG4gICAgfVxufVxuX19kZWNvcmF0ZShbXG4gICAgYXV0b0JpbmRcbl0sIFByb2plY3RMaXN0LnByb3RvdHlwZSwgXCJkcmFnT3ZlckhhbmRsZXJcIiwgbnVsbCk7XG5fX2RlY29yYXRlKFtcbiAgICBhdXRvQmluZFxuXSwgUHJvamVjdExpc3QucHJvdG90eXBlLCBcImRyb3BIYW5kbGVyXCIsIG51bGwpO1xuX19kZWNvcmF0ZShbXG4gICAgYXV0b0JpbmRcbl0sIFByb2plY3RMaXN0LnByb3RvdHlwZSwgXCJkcmFnTGVhdmVIYW5kbGVyXCIsIG51bGwpO1xuIiwiaW1wb3J0IHsgUHJvamVjdElucHV0IH0gZnJvbSBcIi4vY29tcG9uZW50cy9wcm9qZWN0LWlucHV0XCI7XG5pbXBvcnQgeyBQcm9qZWN0TGlzdCB9IGZyb20gXCIuL2NvbXBvbmVudHMvcHJvamVjdC1saXN0XCI7XG5uZXcgUHJvamVjdElucHV0KCk7XG5uZXcgUHJvamVjdExpc3QoXCJhY3RpdmVcIik7XG5uZXcgUHJvamVjdExpc3QoXCJmaW5pc2hlZFwiKTtcbiJdLCJuYW1lcyI6WyJhdXRvQmluZCIsIl8iLCJfMiIsImRlc2NyaXB0b3IiLCJvcmlnaW5hbE1ldGhvZCIsInZhbHVlIiwiY29uZmlndXJhYmxlIiwiZ2V0IiwiYmluZCIsInRoaXMiLCJQcm9qZWN0U3RhdHVzIiwiUHJvamVjdCIsImNvbnN0cnVjdG9yIiwiaWQiLCJ0aXRsZSIsImRlc2NyaXB0aW9uIiwicGVvcGxlIiwic3RhdHVzIiwiU3RhdGUiLCJsaXN0ZW5lcnMiLCJhZGRMaXN0ZW5lciIsImxpc3RlbmVyRm4iLCJwdXNoIiwiUHJvamVjdFN0YXRlIiwic3VwZXIiLCJwcm9qZWN0cyIsImdldEluc3RhbmNlIiwiaW5zdGFuY2UiLCJhZGRQcm9qZWN0IiwibmV3UHJvamVjdCIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsIkFjdGl2ZSIsInVwZGF0ZUxpc3RlbmVycyIsIm1vdmVQcm9qZWN0IiwicHJvamVjdElkIiwibmV3U3RhdHVzIiwicHJvamVjdCIsImZpbmQiLCJwcmoiLCJzbGljZSIsInByb2plY3RTdGF0ZSIsInZhbGlkYXRlIiwidmFsaWRhdGFibGVJbnB1dCIsImlzVmFsaWQiLCJyZXF1aXJlZCIsInRyaW0iLCJsZW5ndGgiLCJtaW5MZW5ndGgiLCJtYXhMZW5ndGgiLCJtaW4iLCJtYXgiLCJDb21wb25lbnQiLCJ0ZW1wbGF0ZUlkIiwiaG9zdEVsZW1lbnRJZCIsImluc2VydEF0U3RhcnQiLCJuZXdFbGVtZW50SWQiLCJ0ZW1wbGF0ZUVsZW1lbnQiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaG9zdEVsZW1lbnQiLCJpbXBvcnRlZE5vZGUiLCJpbXBvcnROb2RlIiwiY29udGVudCIsImVsZW1lbnQiLCJmaXJzdEVsZW1lbnRDaGlsZCIsImF0dGFjaCIsImluc2VydEF0QmVnaW5uaW5nIiwiaW5zZXJ0QWRqYWNlbnRFbGVtZW50IiwiUHJvamVjdElucHV0IiwidGl0bGVJbnB1dEVsZW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwiZGVzY3JpcHRpb25JbnB1dEVsZW1lbnQiLCJwZW9wbGVJbnB1dEVsZW1lbnQiLCJjb25maWd1cmUiLCJyZW5kZXJDb250ZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsInN1Ym1pdEhhbmRsZXIiLCJnYXRoZXJVc2VySW5wdXQiLCJlbnRlcmVkVGl0bGUiLCJlbnRlcmVkRGVzY3JpcHRpb24iLCJlbnRlcmVkUGVvcGxlIiwiZGVzY3JpcHRpb25WYWxpZGF0YWJsZSIsInBlb3BsZVZhbGlkYXRhYmxlIiwiYWxlcnQiLCJldmVudCIsInByZXZlbnREZWZhdWx0IiwidXNlcklucHV0IiwiQXJyYXkiLCJpc0FycmF5IiwiZGVzYyIsImNsZWFySW5wdXRzIiwiZGVjb3JhdG9ycyIsInRhcmdldCIsImtleSIsImQiLCJjIiwiYXJndW1lbnRzIiwiciIsIk9iamVjdCIsImdldE93blByb3BlcnR5RGVzY3JpcHRvciIsIlJlZmxlY3QiLCJkZWNvcmF0ZSIsImkiLCJkZWZpbmVQcm9wZXJ0eSIsIl9fZGVjb3JhdGUiLCJwcm90b3R5cGUiLCJQcm9qZWN0SXRlbSIsInBlcnNvbnMiLCJob3N0SWQiLCJkcmFnU3RhcnRIYW5kbGVyIiwiZGF0YVRyYW5zZmVyIiwic2V0RGF0YSIsImVmZmVjdEFsbG93ZWQiLCJkcmFnRW5kSGFuZGxlciIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0Q29udGVudCIsIlByb2plY3RMaXN0IiwidHlwZSIsImFzc2lnbmVkUHJvamVjdHMiLCJkcmFnT3ZlckhhbmRsZXIiLCJ0eXBlcyIsImNsYXNzTGlzdCIsImFkZCIsImRyb3BIYW5kbGVyIiwicHJqSWQiLCJnZXREYXRhIiwiRmluaXNoZWQiLCJkcmFnTGVhdmVIYW5kbGVyIiwicmVtb3ZlIiwicmVsZXZhbnRQcm9qZWN0cyIsImZpbHRlciIsInJlbmRlclByb2plY3RzIiwibGlzdElkIiwidG9VcHBlckNhc2UiLCJpbm5lckhUTUwiLCJwcmpJdGVtIl0sInNvdXJjZVJvb3QiOiIifQ==